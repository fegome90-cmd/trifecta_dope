version: 1
id: WO-0009
epic_id: E-0001
title: "ctx sync debe indexar contenido del repo (docs/src), no solo _ctx"
priority: P0
status: done
dod_id: DOD-REPRODUCIBILITY
owner: null
branch: "job/WO-0009-sync-repo-content"
worktree: "../wt-WO-0009"

scope:
  allow:
    - "tests/integration/test_ctx_sync_indexes_repo_content.py"
    - "src/application/**" # If build logic needs modification
    - "docs/reports/wo0009_*.md"
    - "_ctx/logs/wo0009_*.log"
  deny:
    - ".env*"
    - "configs/**" # Should not need config changes

objective: |
  Fix ctx sync to index repo content (docs/, src/) in addition to _ctx metadata.

  Current behavior: ctx sync only indexes skill.md, prime, agent, session.
  Expected: ctx sync indexes ALL markdown/code files in segment.

  Blocker for: WO-0008 (A/B linter needs content to search)

deliverables:
  - "tests/integration/test_ctx_sync_indexes_repo_content.py (RED → GREEN)"
  - "Fix in sync/build logic to include docs/src"
  - "Gate script verifying pack contains repo content"
  - "docs/reports/wo0009_sync_repo_content_fix.md"

verify:
  commands:
    - "uv run pytest -xvs tests/integration/test_ctx_sync_indexes_repo_content.py"
    - "bash scripts/gate_ctx_sync_repo_content.sh"

acceptance_criteria:
  - "In synthetic fixture: docs/servicio.md appears in context_pack.json"
  - "grep 'SERVICIO_ANCHOR_TOKEN' pack.json ≠ empty"
  - "ctx search --query 'SERVICIO_ANCHOR_TOKEN' → hits > 0"
  - "Test passes in clean worktree"

diff_budget:
  max_files: 20
  max_loc: 600

dependencies:
  - wo_id: WO-0007 # Requires bootstrap pipeline

risks:
  - "Indexing all files could create huge packs"
  - "Need filtering logic to exclude build artifacts"

mitigation:
  - "Implement file type whitelist (.md, .py, .ts, .yaml)"
  - "Respect .gitignore patterns"
  - "Add pack size gate (warn if >100MB)"

notes: |
  Created to unblock WO-0008.

  Evidence: WO-0008 debug showed pack only contains:
  - skill.md
  - prime_*.md
  - agent_*.md
  - session_*.md

  Missing: user content from docs/, src/, etc.

verified_at_sha: a4bef6d44b5d48b0a25e6b6ed12d5f755caa47bb
evidence_logs:
  - "_ctx/logs/wo0009/00_sha.txt"
  - "_ctx/logs/wo0009/01_locate_sync.log"
  - "_ctx/logs/wo0009/02_analysis_notes.md"
  - "_ctx/logs/wo0009_green_final/01_pytest_fail.log"
  - "_ctx/logs/wo0009_green_final/02_pytest_green.log"
  - "_ctx/logs/wo0009_green_final/03_gate_wo0007.log"
