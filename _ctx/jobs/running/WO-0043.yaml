version: 1
id: WO-0043
epic_id: E-TESTS-CONTRACT
title: Convertir 2 integration failures en gates de contrato
priority: P0
status: running
owner: felipe_gonzalez
branch: feat/wo-WO-0043
worktree: ../.worktrees/WO-0043
scope:
  allow:
  - tests/integration/test_naming_contract_integration.py
  - tests/integration/test_repro_clean_sync_then_search.py
  - src/cli/error_cards.py
  - src/application/exceptions.py
  - docs/contracts/ERROR_CODES.md
  deny:
  - .env*
  - '**/production.*'
  - src/domain/**
verify:
  commands:
  - uv run pytest tests/integration/test_naming_contract_integration.py -v
  - uv run pytest tests/integration/test_repro_clean_sync_then_search.py -v
  - make gate-all
dod_id: DOD-DEFAULT
execution:
  engine: trifecta
  required_flow:
  - verify
  segment: .
trace:
  ticket: null
  related_wos:
  - WO-0042
claim_links:
  requirements:
  - Tests usan asserts de contrato (estructura), no texto
  - Error codes estables y documentados
  - Shape de error card validado
  assumptions:
  - Error card system funciona correctamente
  constraints:
  - No cambiar comportamiento, solo tests
  - Mantener cobertura existente
objective: "Arreglar los 2 tests de integraci\xF3n que fallan y blindarlos como contratos estables.\n\
  Migrar de asserts fr\xE1giles (texto) a asserts de contrato (c\xF3digos estructurados).\n"
started_at: '2026-02-13T18:02:36.936099+00:00'
deliverables:
- 'test_naming_contract_integration.py: arreglado y usando TRIFECTA_ERROR_CODE'
- 'test_repro_clean_sync_then_search.py: arreglado y usando error cards'
- "Test de contamination: valida shape de error card + c\xF3digo, no mensaje"
- 'Test de error code: assert por estructura estable'
- "Documentaci\xF3n de contratos de error en docs/contracts/ERROR_CODES.md"
diff_budget:
  max_files: 6
  max_loc: 200
stop_conditions:
  max_iterations: 4
  max_fail_verify: 1
