version: 1
id: WO-0053
epic_id: E-SCALE
title: Path Guardrails - CLI Input Validation + Security
priority: P0
status: pending
owner: null
branch: null
worktree: null
scope:
  allow:
  - src/infrastructure/path_utils.py
  - src/infrastructure/cli.py
  - src/domain/validators.py
  deny:
  - .env*
verify:
  commands:
  - uv run pytest tests/unit/test_path_guardrails.py -v
  - uv run ruff check src/infrastructure/path_utils.py src/infrastructure/cli.py
dod_id: DOD-DEFAULT
execution:
  engine: trifecta
  required_flow:
  - ctx.sync
  - ctx.search
  - ctx.get
  segment: .
dependencies: []
claim_links:
  requirements:
  - Path canonicalization: Resolve symlinks and relative paths consistently
  - Path traversal prevention: Block ../ escapes outside segment root
  - Invalid WO ID detection: Validate WO IDs match pattern
  - Segment scope validation: Verify path stays within segment boundary
  assumptions:
  - A-SCALE-001: Zero-hit tracker is working (from WO-0052)
  constraints:
  - CN-SCALE-001: Use pathlib.Path.resolve() for canonicalization
  - CN-SCALE-002: Return typed errors, not raw exceptions
objective: 'Implement path validation for CLI inputs preventing:
  - Path traversal attacks (../ escapes)
  - Canonicalization inconsistencies
  - Invalid scope (path outside segment root)
  - Invalid WO ID formats
  '
deliverables:
  - Module src/infrastructure/path_utils.py with guardrail functions
  - Integration points in CLI for --segment, --path options
  - Unit tests covering edge cases
  - Integration with telemetry (log path validation failures)
diff_budget:
  max_files: 5
  max_loc: 200
