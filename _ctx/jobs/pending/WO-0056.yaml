# WO-0056: Test Suite Stabilization
# Generated: 2026-02-18
# Updated: 2026-02-18
# Status: pending
# Priority: P1
# Epic: E-0002 (Code Quality & Technical Debt)

id: WO-0056
title: "Test Suite Stabilization - Fix 62 Pre-existing Failures"
status: pending
priority: P1
epic: E-0002

description: |
  Stabilize the test suite by fixing or properly skipping 62 pre-existing failing tests.
  These failures were identified during governance hardening work (WO-0055) and are
  blocking the verification gate.
  
  UPDATE: 2 ERRORS fixed in cli.py (trifecta create no longer requires _ctx to exist).
  Remaining: 62 failures (down from 64 + 2 errors).

scope:
  - Fix failing unit tests in tests/unit/
  - Fix failing acceptance tests in tests/acceptance/
  - Ensure all tests pass or have formal skip reasons
  - No domain layer modifications

execution_matrix:
  - cluster: "WO-State"
    priority: P1
    tests: 3
    file: "tests/unit/test_ctx_reconcile_state.py"
    effort: "S"
    commands:
      - "uv run pytest tests/unit/test_ctx_reconcile_state.py -v"
    
  - cluster: "WO-Lint"
    priority: P2
    tests: 3
    file: "tests/unit/test_ctx_wo_lint.py"
    effort: "S"
    commands:
      - "uv run pytest tests/unit/test_ctx_wo_lint.py -v"
    
  - cluster: "WO-Take"
    priority: P1
    tests: 2
    file: "tests/unit/test_ctx_wo_take.py"
    effort: "S"
    commands:
      - "uv run pytest tests/unit/test_ctx_wo_take.py -v"
    
  - cluster: "LSP-Contract"
    priority: P2
    tests: 1
    file: "tests/unit/test_lsp_ready_contract.py"
    effort: "S"
    commands:
      - "uv run pytest tests/unit/test_lsp_ready_contract.py -v"
    
  - cluster: "Telemetry-Health"
    priority: P2
    tests: 1
    file: "tests/unit/test_telemetry_health.py"
    effort: "S"
    commands:
      - "uv run pytest tests/unit/test_telemetry_health.py -v"
    
  - cluster: "Evidence-Validation"
    priority: P1
    tests: 3
    file: "tests/unit/test_wo_finish_requires_evidence.py"
    effort: "M"
    commands:
      - "uv run pytest tests/unit/test_wo_finish_requires_evidence.py -v"
    
  - cluster: "WO-Verify"
    priority: P1
    tests: 4
    file: "tests/unit/test_wo_verify_trap.py"
    effort: "M"
    commands:
      - "uv run pytest tests/unit/test_wo_verify_trap.py -v"
    
  - cluster: "CLI-Smoke"
    priority: P1
    tests: 1
    file: "tests/acceptance/test_cli_smoke_real_use.py"
    effort: "S"
    commands:
      - "uv run pytest tests/acceptance/test_cli_smoke_real_use.py -v"

sub_wo_recommendation: |
  If WO-0056 is too large, split into:
  - WO-0057: WO-State + WO-Take + WO-Verify clusters (9 tests, P1)
  - WO-0058: Evidence-Validation cluster (3 tests, P1)
  - WO-0059: WO-Lint + LSP-Contract + Telemetry-Health (5 tests, P2)
  - WO-0060: CLI-Smoke (1 test, P1)

dod:
  - "All 62 failing tests pass OR have formal skip with documented reason"
  - "pytest exits with code 0"
  - "No regression in passing tests"
  - "mypy --strict passes on modified files"
  - "ruff check passes on modified files"

acceptance_criteria:
  - "uv run pytest exits 0"
  - "No test failures in CI"
  - "Test coverage maintained or improved"

dependencies: []
blocked_by: []

metadata:
  created_at: "2026-02-18T11:26:00-03:00"
  updated_at: "2026-02-18T11:56:00-03:00"
  created_by: "governance_hardening_task"
  related_wo: "WO-0055"
  estimated_effort: "M"  # Medium - multiple test files
  original_failures: 64
  original_errors: 2
  errors_fixed: 2
  remaining_failures: 40
  remaining_errors: 0
  new_tests_added: 11  # bypass telemetry tests
