version: 1
id: WO-0004
epic_id: E-0001
title: "IntegraciÃ³n CLI: flags + pipeline tokenize-after-lint + telemetry sanitizada (Fase 4)"
priority: P0
status: pending
owner: null
branch: "job/WO-0004-query-linter-cli"
worktree: "../wt-WO-0004"
scope:
  allow:
    - "src/application/**"
    - "src/infrastructure/**"
    - "tests/**"
    - "docs/**"
  deny:
    - ".env*"
    - "**/production.*"
deliverables:
  - "src/infrastructure/config_loader.py (configs/ unificados, missing_config marker)"
  - "src/application/search_get_usecases.py (lint -> tokenize -> expander -> search)"
  - "src/infrastructure/cli.py (--no-lint + TRIFECTA_LINT default OFF)"
  - "tests/unit/test_search_usecase_linter.py"
  - "tests/integration/test_ctx_search_linter.py (A/B con context_pack.json real JSON)"
  - "tests/integration/test_ctx_search_linter_ab_controlled.py (A/B controlado: OFF=0, ON>0)"
  - "docs/reports/query_linter_cli_verification.md (evidencia cruda + JSONL ON/OFF)"
  - "_ctx/logs/ab_off.log + _ctx/logs/ab_on.log"
verify:
  commands:
    - "scripts/verify.sh"
    - "uv run pytest -q tests/unit/test_search_usecase_linter.py"
    - "uv run pytest -q tests/integration/test_ctx_search_linter.py"
    - "uv run pytest -q tests/integration/test_ctx_search_linter_ab_controlled.py"
diff_budget:
  max_files: 12
  max_loc: 400
stop_conditions:
  max_iterations: 6
  max_fail_verify: 2
dod_id: DOD-DEFAULT
trace:
  ticket: null
  related_wos: []
