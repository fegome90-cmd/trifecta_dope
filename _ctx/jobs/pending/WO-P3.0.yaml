version: 1
id: WO-P3.0
epic_id: E-0001
title: "AST Cache Soak Run (Real Telemetry)"
priority: P1
status: pending
owner: null

scope:
  allow:
    - "eval/scripts/run_ast_cache_soak.sh"
    - "eval/scripts/extract_ast_soak_metrics.py"
    - "eval/scripts/gate_ast_soak.py"
    - "_ctx/metrics/ast_soak_*.json"
    - "_ctx/logs/wo_p3_0/*.log"
  deny:
    - "src/domain/**"
    - "tests/soak/**" # No pytest based soak

verify:
  commands:
    - "bash eval/scripts/run_ast_cache_soak.sh"
    - "python eval/scripts/gate_ast_soak.py"

dod_id: DOD-DEFAULT

x_objective: |
  Obtener evidencia OPERATIVA real (no contractual) del AST Cache.
  Foco: hit/miss progression, lock contention, y DB integrity bajo carga (200 ops).
  Estrategia: Micro-tasks harnessing (no pytest).

x_deliverables:
  - "eval/scripts/run_ast_cache_soak.sh (Parametric Harness)"
  - "eval/scripts/extract_ast_soak_metrics.py (Metrics Extractor)"
  - "eval/scripts/gate_ast_soak.py (Deterministic Gate)"
  - "Evidence artifacts (_ctx/metrics/*.json, _ctx/logs/wo_p3_0/*.log)"

x_acceptance_criteria:
  - "Integrity check == 'ok' post-run"
  - "Ops completadas >= OPS param"
  - "Warm hit rate > Cold hit rate (evidencia de cacheo)"
  - "Lock timeouts <= 1 (tolerancia mínima)"
  - "NO performance gates (p95 latency es informativo)"

x_micro_tasks:
  - name: "T1: Read & Anchor (Zero-Code)"
    gate: "Evidence logs with code citations (grep/sed) for persist/events/paths"
    commit: "None"
  - name: "T2: Harness Mínimo"
    gate: "exit 0 with OPS=10, logs created"
    commit: "feat(eval): add ast cache soak harness (parametric)"
  - name: "T3: Extractor Métricas"
    gate: "JSON valid + counts/latency fields present"
    commit: "feat(eval): add ast soak metrics extractor"
  - name: "T4: Gate Determinista"
    gate: "Script exits 0 (PASS) or 1 (FAIL) correctly based on limits"
    commit: "test(eval): add deterministic soak gates"
  - name: "T5: Live Run + Evidence"
    gate: "gate_ast_soak.py PASS with OPS=200"
    commit: "feat(eval): record ast soak run P3.0 evidence"
  - name: "T6: Gobernanza"
    gate: "git status clean, YAMLs updated"
    commit: "docs(ast): close WO-P3.0 soak audit-grade"

dependencies:
  - WO-P2.2
