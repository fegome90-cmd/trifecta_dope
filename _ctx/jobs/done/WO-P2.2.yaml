version: 1
id: WO-P2.2
epic_id: E-0001
title: AST Cache File Locks (Wrapper Pattern)
priority: P0
status: done
owner: null
scope:
  allow:
  - src/infrastructure/file_locked_cache.py
  - src/infrastructure/factories.py
  - tests/integration/test_ast_cache_file_locks.py
  deny:
  - .env*
verify:
  commands:
  - uv run pytest -q tests/integration/test_ast_cache_file_locks.py
  - uv run pytest -q tests/integration/test_ast_cache_telemetry.py
  verified_at_sha: c2d0338
dod_id: DOD-DEFAULT
dependencies:
- WO-P2.1
evidence_logs:
- _ctx/logs/wo_p2_2/02_contractual_tests.log
- _ctx/logs/wo_p2_2/03_regression.log
- _ctx/logs/wo_p2_2/audit_timeout_evidence.log
- _ctx/logs/wo_p2_2/audit_concurrent_evidence.log
- _ctx/logs/wo_p2_2/audit_telemetry_samples.jsonl
x_objective: 'Wrapper pattern para file locking sin tocar SQLiteCache.

  '
x_deliverables:
- FileLockedAstCache wrapper (115 lines)
- Factory integration (5 lines added)
- Contractual tests (4/4 PASSED)
- 'Events: ast.cache.lock_timeout, ast.cache.lock_wait'
x_notes: 'Completed 2026-01-06.


  Wrapper approach (vs modifying SQLiteCache) keeps OS concerns in infrastructure.

  No changes to domain layer.


  Tests: 4 contractual + 5 regression = 9/9 PASSED

  '
