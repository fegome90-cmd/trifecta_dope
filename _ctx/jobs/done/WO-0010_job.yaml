version: 1
id: WO-0010
epic_id: E-0001
title: "Field Exercises v1: Real-World Query A/B Evaluation"
priority: P1
status: done
owner: null

scope:
  allow:
    - "eval/field_exercises_v1.yaml"
    - "eval/scripts/run_field_exercises_ab.py"
    - "docs/reports/field_exercises_v1_results.md"
    - "_ctx/logs/field_ex_*.log"
  deny:
    - "src/**" # No source modifications needed
    - ".env*"

verify:
  commands:
    - "uv run python eval/scripts/run_field_exercises_ab.py --validate"
    - "grep 'zero_hit_rate:' docs/reports/field_exercises_v1_results.md"

dod_id: DOD-FIELD_EXERCISES

x_objective: |
  Validar el sistema de búsqueda con queries reales del mundo real.

  Dataset: 20 queries representativas de casos de uso reales
  A/B: Comparar OFF (sin linter) vs ON (con linter)
  Métricas: hit_rate, zero_hit_rate, precision@5
  Gate: zero_hit_rate < 30% (al menos 70% de queries retornan resultados)

x_deliverables:
  - "eval/field_exercises_v1.yaml (20 queries reales con expected hits)"
  - "eval/scripts/run_field_exercises_ab.py (runner automatizado)"
  - "docs/reports/field_exercises_v1_results.md (métricas + análisis)"
  - "_ctx/logs/field_ex_{off,on}.log (evidencia CLI)"

x_acceptance_criteria:
  - "Dataset tiene 20 queries variadas (técnicas, conceptuales, vagas, específicas)"
  - "Cada query tiene expected_min_hits (baseline mínimo)"
  - "Runner ejecuta: OFF → captura hits, ON → captura hits"
  - "Reporte muestra: zero_hit_rate, avg_hits, delta ON-OFF"
  - "Gate: zero_hit_rate_on < 30% (máximo 6 queries sin resultados)"

diff_budget:
  max_files: 8
  max_loc: 300

x_dependencies:
  - wo_id: WO-0008 # Requiere A/B linter funcional
  - wo_id: WO-0009 # Requiere ctx sync indexando repo content

x_risks:
  - "Queries demasiado específicas → falsos negativos (no match por dataset pequeño)"
  - "Zero-hit rate puede ser alto si dataset incompleto"

x_mitigation:
  - "Mezclar tipos de query: 30% técnicas, 30% conceptuales, 40% discovery"
  - "Usar queries que sabemos que deben matchear contenido existente"
  - "Si zero_hit_rate > 30%, documentar queries problemáticas para iteración"

x_notes: |
  Este WO establece el primer benchmark cuantitativo del sistema de búsqueda.

  No es un test unitario: es una evaluación de calidad en queries reales.
  Si el gate falla, indica que el sistema necesita mejoras (no que el código está roto).
