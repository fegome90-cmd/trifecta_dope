# aliases.yaml - Alias to feature_id mapping for ctx.plan L2/L3 matching
# Schema: Each alias maps to a feature_id (not free text)
# T9.3.1: Added anchors[] for bundle assertions
# T9.3.2: Added nl_triggers[] for direct L2 matching (canonical intent phrases)

schema_version: 3

features:
  observability_telemetry:
    priority: 4
    support_terms:
      - stats
      - metrics
      - events
      - jsonl
      - latency
      - p95
      - p50
      - flush
    nl_triggers:
      - "ctx stats"
      - "telemetry statistics"
      - "search performance"
      - "token tracking"
      - "event tracking"
      - "telemetry"
      - "metrics"
      - "events.jsonl"
    triggers:
      - phrase: "ctx stats"
        terms: ["ctx", "stats"]
        high_signal: true
        notes: "CLI command for telemetry statistics"
      - phrase: "hit rate"
        terms: ["hit", "rate"]
        high_signal: false
        notes: "Search success metric"
      - phrase: "zero hits"
        terms: ["zero", "hits"]
        high_signal: false
        notes: "Failed searches metric"
      - phrase: "events.jsonl"
        terms: ["events", "jsonl"]
        high_signal: true
        notes: "Telemetry event log file"
      - phrase: "telemetry event"
        terms: ["telemetry", "event"]
        high_signal: false
        notes: "Individual telemetry record"
      - phrase: "token tracking"
        terms: ["token", "tracking"]
        high_signal: false
        notes: "Token usage monitoring"
      - phrase: "latency metrics"
        terms: ["latency", "metrics"]
        high_signal: false
        notes: "Performance timing data"
    bundle:
      chunks:
        - "telemetry"
        - "events"
        - "Telemetry"
      paths: []
      anchors: []

  context_pack:
    priority: 3
    nl_triggers:
      - "context pack build"
      - "validate context"
      - "context pack sync"
      - "context pack status"
      - "build command"
      - "ctx validate"
    triggers:
      - phrase: "context pack build"
        terms: ["context", "pack", "build"]
        high_signal: false
        notes: "Build process for context packs"
      - phrase: "validate context"
        terms: ["validate", "context"]
        high_signal: false
        notes: "Validation of context pack integrity"
      - phrase: "context pack sync"
        terms: ["context", "pack", "sync"]
        high_signal: false
        notes: "Sync operation for context packs"
      - phrase: "context pack status"
        terms: ["context", "pack", "status"]
        high_signal: false
        notes: "Status check for context packs"
    bundle:
      chunks:
        - "BuildContextPackUseCase"
        - "ValidateContextPackUseCase"
        - "ContextPack"
      paths: []
      anchors: []

  cli_commands:
    priority: 3
    nl_triggers:
      - "ctx search"
      - "ctx get"
      - "ctx sync"
      - "ctx stats"
      - "list commands"
      - "typer commands"
      - "available commands"
    triggers:
      - phrase: "ctx.search command"
        terms: ["ctx", "search", "command"]
        high_signal: true
        notes: "CLI search command"
      - phrase: "ctx.get command"
        terms: ["ctx", "get", "command"]
        high_signal: true
        notes: "CLI get command"
      - phrase: "ctx.sync command"
        terms: ["ctx", "sync", "command"]
        high_signal: true
        notes: "CLI sync command"
      - phrase: "load command"
        terms: ["load", "command"]
        high_signal: false
        notes: "Macro load command"
      - phrase: "cli commands defined"
        terms: ["cli", "commands", "defined"]
        high_signal: false
        notes: "Query about CLI command definitions"
      - phrase: "typer commands"
        terms: ["typer", "commands"]
        high_signal: false
        notes: "Typer CLI commands"
      - phrase: "list commands"
        terms: ["list", "commands"]
        high_signal: false
        notes: "List available commands"
    bundle:
      chunks:
        - "@ctx_app.command"
        - "typer"
        - "def "
      paths: []
      anchors: []

  search:
    priority: 3
    nl_triggers:
      - "search use case"
      - "search query"
      - "search functionality"
      - "SearchUseCase class"
    triggers:
      - phrase: "SearchUseCase class"
        terms: ["searchusecase", "class"]
        high_signal: true
        notes: "Specific class name"
      - phrase: "search use case"
        terms: ["search", "use", "case"]
        high_signal: false
        notes: "Search functionality pattern"
      - phrase: "search query"
        terms: ["search", "query"]
        high_signal: false
        notes: "Query-based search"
    bundle:
      chunks:
        - "SearchUseCase"
        - "execute"
        - "search"
      paths: []
      anchors: []

  stats:
    priority: 3
    nl_triggers:
      - "statistics command"
      - "zero-hits analysis"
      - "search performance stats"
      - "StatsUseCase class"
    triggers:
      - phrase: "StatsUseCase class"
        terms: ["statsusecase", "class"]
        high_signal: true
        notes: "Specific class name"
      - phrase: "statistics command"
        terms: ["statistics", "command"]
        high_signal: false
        notes: "Stats functionality"
      - phrase: "zero-hits analysis"
        terms: ["zero", "hits", "analysis"]
        high_signal: false
        notes: "Failed search analysis"
    bundle:
      chunks:
        - "StatsUseCase"
        - "execute"
        - "stats"
      paths: []
      anchors: []

  arch_overview:
    priority: 2
    nl_triggers:
      - "repo architecture"
      - "project structure"
      - "design overview"
      - "architecture layers"
      - "clean architecture"
      - "architecture"
      - "design"
    triggers:
      - phrase: "repo architecture"
        terms: ["repo", "architecture"]
        high_signal: false
        notes: "Repository structure overview"
      - phrase: "project structure"
        terms: ["project", "structure"]
        high_signal: false
        notes: "Project organization"
      - phrase: "design overview"
        terms: ["design", "overview"]
        high_signal: false
        notes: "High-level design view"
      - phrase: "architecture layers"
        terms: ["architecture", "layers"]
        high_signal: false
        notes: "Clean architecture layers"
      - phrase: "clean architecture"
        terms: ["clean", "architecture"]
        high_signal: false
        notes: "Architecture pattern used"
      - phrase: "description of prime structure"
        terms: ["prime", "structure"]
        high_signal: true
        notes: "PRIME file structure"
    bundle:
      chunks:
        - "Architecture"
        - "Layers"
        - "prime"
      paths: []
      anchors: []

  symbol_surface:
    priority: 2
    nl_triggers:
      - "symbol extraction"
      - "symbol references"
      - "definition lookup"
      - "function implementation"
      - "class initialization"
      - "telemetry class"
    triggers:
      - phrase: "symbol extraction"
        terms: ["symbol", "extraction"]
        high_signal: false
        notes: "Extracting code symbols"
      - phrase: "symbol references"
        terms: ["symbol", "references"]
        high_signal: false
        notes: "Finding symbol usage"
      - phrase: "definition lookup"
        terms: ["definition", "lookup"]
        high_signal: false
        notes: "Looking up definitions"
      - phrase: "symbols in cli.py"
        terms: ["symbols", "cli.py"]
        high_signal: true
        notes: "Specific file symbol query"
      - phrase: "function implementation"
        terms: ["function", "implementation"]
        high_signal: false
        notes: "Function implementation details"
      - phrase: "class initialization"
        terms: ["class", "initialization"]
        high_signal: false
        notes: "Class constructor code"
    bundle:
      chunks:
        - "Symbol"
        - "class"
        - "function"
      paths: []
      anchors: []

  code_navigation:
    priority: 2
    nl_triggers:
      - "entrypoints modules"
      - "implement use case"
      - "code navigation"
      - "module entry points"
    triggers:
      - phrase: "entrypoints modules"
        terms: ["entrypoints", "modules"]
        high_signal: false
        notes: "Module entry points"
      - phrase: "implement use case"
        terms: ["implement", "use", "case"]
        high_signal: false
        notes: "Implementation guidance for use cases"
      - phrase: "where to start"
        terms: ["start", "where"]
        high_signal: false
        notes: "Entry point for navigation"
      - phrase: "how modules interact"
        terms: ["modules", "interact"]
        high_signal: false
        notes: "Module interaction patterns"
      - phrase: "files in directory"
        terms: ["files", "directory"]
        high_signal: false
        notes: "Directory listing query"
      - phrase: "code pattern"
        terms: ["code", "pattern"]
        high_signal: false
        notes: "Implementation patterns"
    bundle:
      chunks:
        - "Files"
        - "Path"
        - "Module"
      paths: []
      anchors: []

  token_estimation:
    priority: 4
    nl_triggers:
      - "token counting"
      - "token formula"
      - "estimate tokens"
      - "_estimate_tokens"
    triggers:
      - phrase: "token counting"
        terms: ["token", "counting"]
        high_signal: false
        notes: "Token counting logic"
      - phrase: "token formula"
        terms: ["token", "formula"]
        high_signal: false
        notes: "Token calculation formula"
      - phrase: "_estimate_tokens"
        terms: ["_estimate_tokens"]
        high_signal: true
        notes: "Specific function name"
    bundle:
      chunks:
        - "token"
        - "estimate"
      paths: []
      anchors: []

  prime_indexing:
    priority: 3
    nl_triggers:
      - "prime reading list"
      - "prime index"
      - "prime file format"
      - "reading order"
    triggers:
      - phrase: "prime reading list"
        terms: ["prime", "reading", "list"]
        high_signal: false
        notes: "PRIME reading order"
    bundle:
      chunks:
        - "Index"
        - "lectura"
        - "entrada"
      paths: []
      anchors: []

  chunk_retrieval_flow:
    priority: 3
    nl_triggers:
      - "chunk retrieval"
      - "get chunks"
      - "chunk fetching"
      - "retrieval process"
    triggers:
      - phrase: "chunk retrieval"
        terms: ["chunk", "retrieval"]
        high_signal: false
        notes: "Chunk retrieval process"
      - phrase: "get chunks"
        terms: ["get", "chunks"]
        high_signal: false
        notes: "Chunk fetching"
    bundle:
      chunks:
        - "UseCase"
        - "class"
        - "execute"
      paths: []
      anchors: []

  get_chunk_use_case:
    priority: 3
    nl_triggers:
      - "GetChunkUseCase"
      - "get chunk use case"
      - "locate GetChunkUseCase"
    triggers:
      - phrase: "GetChunkUseCase"
        terms: ["getchunkusecase"]
        high_signal: true
        notes: "Specific class name"
      - phrase: "get chunk use case"
        terms: ["get", "chunk", "use", "case"]
        high_signal: false
        notes: "GetChunk functionality"
      - phrase: "locate GetChunkUseCase"
        terms: ["locate", "getchunkusecase"]
        high_signal: true
        notes: "Finding GetChunkUseCase class"
    bundle:
      chunks:
        - "GetChunkUseCase"
        - "class GetChunkUseCase"
      paths: []
      anchors: []

  telemetry_flush:
    priority: 4
    nl_triggers:
      - "flush mechanism"
      - "event flush"
      - "telemetry flush"
      - "flush events"
    triggers:
      - phrase: "flush mechanism"
        terms: ["flush", "mechanism"]
        high_signal: false
        notes: "Flush implementation"
      - phrase: "event flush"
        terms: ["event", "flush"]
        high_signal: false
        notes: "Event flushing"
      - phrase: "telemetry flush"
        terms: ["telemetry", "flush"]
        high_signal: false
        notes: "Telemetry flush operation"
    bundle:
      chunks:
        - "flush"
        - "def flush"
      paths: []
      anchors: []

  import_statements:
    priority: 3
    nl_triggers:
      - "import statements"
      - "imports needed"
      - "what imports"
      - "required imports"
    triggers:
      - phrase: "import statements"
        terms: ["import", "statements"]
        high_signal: false
        notes: "Import queries"
      - phrase: "imports needed"
        terms: ["imports", "needed"]
        high_signal: false
        notes: "Required imports"
      - phrase: "what imports"
        terms: ["imports"]
        high_signal: false
        notes: "Import dependencies"
      - phrase: "what imports are needed"
        terms: ["imports", "needed"]
        high_signal: false
        notes: "Required imports query"
    bundle:
      chunks:
        - "Module"
        - "Path"
      paths: []
      anchors: []

  directory_listing:
    priority: 2
    nl_triggers:
      - "files under src"
      - "files in directory"
      - "list files"
      - "what files exist"
      - "directory listing"
    triggers:
      - phrase: "files under src"
        terms: ["files", "src"]
        high_signal: false
        notes: "Directory listing"
      - phrase: "files in directory"
        terms: ["files", "directory"]
        high_signal: false
        notes: "Directory contents"
      - phrase: "list files"
        terms: ["list", "files"]
        high_signal: false
        notes: "File listing"
      - phrase: "what files exist"
        terms: ["files", "exist"]
        high_signal: false
        notes: "File listing query"
      - phrase: "files exist under"
        terms: ["files", "exist", "under"]
        high_signal: false
        notes: "Directory listing query"
    bundle:
      chunks:
        - "File"
        - "Path"
      paths: []
      anchors: []
